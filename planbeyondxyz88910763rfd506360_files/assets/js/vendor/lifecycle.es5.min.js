!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.lifecycle=t()}(this,function(){"use strict";var e=void 0;try{new EventTarget,e=!1}catch(a){e=!1}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),e};s(b,[{key:"addEventListener",value:function(e,t){this._getRegistry(e).push(t)}},{key:"removeEventListener",value:function(e,t){e=this._getRegistry(e),t=e.indexOf(t);-1<t&&e.splice(t,1)}},{key:"dispatchEvent",value:function(t){return t.target=this,Object.freeze(t),this._getRegistry(t.type).forEach(function(e){return e(t)}),!0}},{key:"_getRegistry",value:function(e){return this._registry[e]=this._registry[e]||[]}}]);function r(e){return e.preventDefault(),e.returnValue="Are you sure?"}function o(){return document.visibilityState===d?d:document.hasFocus()?c:h}var u=e?EventTarget:b,e=e?Event:function e(t){n(this,e),this.type=t},f=(t(_,e),_),c="active",h="passive",d="hidden",l="frozen",p="terminated",y="object"===("undefined"==typeof safari?"undefined":a(safari))&&safari.pushNotification,v=["focus","blur","visibilitychange","freeze","resume","pageshow","onpageshow"in self?"pagehide":"unload"],g=[[c,h,d,p],[c,h,d,l],[d,h,c],[l,d],[l,c],[l,h]].map(function(e){return e.reduce(function(e,t,n){return e[t]=n,e},{})});function _(e,t){n(this,_);e=i(this,(_.__proto__||Object.getPrototypeOf(_)).call(this,e));return e.newState=t.newState,e.oldState=t.oldState,e.originalEvent=t.originalEvent,e}function b(){n(this,b),this._registry={}}function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return t(E,u),s(E,[{key:"addUnsavedChanges",value:function(e){-1<!this._unsavedChanges.indexOf(e)&&(0===this._unsavedChanges.length&&addEventListener("beforeunload",r),this._unsavedChanges.push(e))}},{key:"removeUnsavedChanges",value:function(e){e=this._unsavedChanges.indexOf(e);-1<e&&(this._unsavedChanges.splice(e,1),0===this._unsavedChanges.length)&&removeEventListener("beforeunload",r)}},{key:"_dispatchChangesIfNeeded",value:function(e,t){if(t!==this._state)for(var n=function(e,t){for(var n,i=0;n=g[i];++i){var a=n[e],s=n[t];if(0<=a&&0<=s&&a<s)return Object.keys(n).slice(a,s+1)}return[]}(this._state,t),i=0;i<n.length-1;++i){var a=n[i],s=n[i+1];this._state=s,this.dispatchEvent(new f("statechange",{oldState:a,newState:s,originalEvent:e}))}}},{key:"_handleEvents",value:function(e){switch(y&&clearTimeout(this._safariBeforeUnloadTimeout),e.type){case"pageshow":case"resume":this._dispatchChangesIfNeeded(e,o());break;case"focus":this._dispatchChangesIfNeeded(e,c);break;case"blur":this._state===c&&this._dispatchChangesIfNeeded(e,o());break;case"pagehide":case"unload":this._dispatchChangesIfNeeded(e,e.persisted?l:p);break;case"visibilitychange":this._state!==l&&this._state!==p&&this._dispatchChangesIfNeeded(e,o());break;case"freeze":this._dispatchChangesIfNeeded(e,l)}}},{key:"state",get:function(){return this._state}},{key:"pageWasDiscarded",get:function(){return document.wasDiscarded||!1}}]),new E;function E(){n(this,E);var t=i(this,(E.__proto__||Object.getPrototypeOf(E)).call(this)),e=o();return t._state=e,t._unsavedChanges=[],t._handleEvents=t._handleEvents.bind(t),v.forEach(function(e){return addEventListener(e,t._handleEvents,!0)}),y&&addEventListener("beforeunload",function(e){t._safariBeforeUnloadTimeout=setTimeout(function(){e.defaultPrevented||0<e.returnValue.length||t._dispatchChangesIfNeeded(e,d)},0)}),t}});