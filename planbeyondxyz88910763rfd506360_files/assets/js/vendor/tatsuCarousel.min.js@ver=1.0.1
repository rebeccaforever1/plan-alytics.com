"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e,i){"function"==typeof define&&define.amd?define("TatsuCarousel",e):"object"==("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e(i):t.TatsuCarousel=e(i)}(window,function(s){function a(t){null==t||t.hasClass("slider-initialized")||(s.fn.hasOwnProperty("flickity")?null!=t&&t instanceof s?(this.ele=t,this.prevWidth=window.innerWidth,this.inViewport=t.isVisible(100),this.bindMethods(),this.setFlickitySettings(),this.initLazyLoad(),this.initFullscreenSlider(),this.initVariableSlider(),this.initDestroyInMobile(),this.initEvents(),this.adjustArrows(),this.initFlickity()):console.error("Invalid Arg passed to TatsuCarousel"):console.error("Flickity is not added. TatsuCarousel depends on Flickity"))}var o=s(window);return a.prototype.initFullscreenSlider=function(){var t,e,i,a;"1"===this.ele.attr("data-fullscreen")&&(767<window.innerWidth||null==this.ele.attr("data-destroy-in-mobile")&&null==this.ele.attr("data-variable-width"))&&(t=this.ele.attr("data-fullscreen-offset"),e=o.height(),i=this.ele.find(".tatsu-carousel-col-inner"),a=0,"string"==typeof t&&t.split(",").forEach(function(t){var e=s(t);0<t.length&&(a+=e.height())}),i.css("height",e-a+"px"))},a.prototype.updateFullscreenSlider=function(){var t,e,i,a;(767<window.innerWidth||null==this.ele.attr("data-destroy-in-mobile")&&null==this.ele.attr("data-variable-width"))&&(t=this.ele.attr("data-fullscreen-offset"),e=o.height(),i=this.ele.find(".tatsu-carousel-col-inner"),a=0,"string"==typeof t&&t.split(",").forEach(function(t){var e=s(t);0<t.length&&(a+=e.height())}),i.css("height",e-a+"px"))},a.prototype.adjustArrows=function(){var t;!0===this.settings.prevNextButtons&&null!=this.ele.attr("data-outer-arrows")&&s(window).width()>this.ele.width()&&(t=isNaN(parseInt(this.ele.attr("data-gutter")))?0:parseInt(this.ele.attr("data-gutter")),this.ele.css({margin:"0 -"+(t/2+50)+"px",padding:"0 50px"}))},a.prototype.bindMethods=function(){this.lazyLoad=this.lazyLoad.bind(this),this.throttledLazyLoad="function"==typeof s.throttle?s.throttle(this.lazyLoad,200):this.lazyLoad,this.flickityInit=this.flickityInit.bind(this),this.updateVariableSlider=this.updateVariableSlider.bind(this),this.updateFullscreenSlider=this.updateFullscreenSlider.bind(this),this.destroyInMobile=this.destroyInMobile.bind(this),this.lazyLoadOnScroll=this.lazyLoadOnScroll.bind(this),this.updatePreviousWidth=this.updatePreviousWidth.bind(this)},a.prototype.setFlickitySettings=function(){this.settings=null;var t={};"1"==this.ele.attr("data-center-mode")&&(t.cellAlign="center"),"1"==this.ele.attr("data-autoplay")&&(t.autoPlay=isNaN(Number(this.ele.attr("data-autoplay-speed")))?3e3:Number(this.ele.attr("data-autoplay-speed"))),"1"==this.ele.attr("data-dots")&&(t.pageDots=!0),"1"===this.ele.attr("data-destroy-in-mobile")&&(t.watchCSS=!0),"1"==this.ele.attr("data-arrows")&&(t.prevNextButtons=!0),"1"==this.ele.attr("data-variable-width")&&(window.innerWidth<=767?t.adaptiveHeight=!0:t.percentPosition=!1),"1"==this.ele.attr("data-infinite")&&(t.wrapAround=!0),"1"==this.ele.attr("data-free-scroll")&&(t.freeScroll=!0),this.settings=s.extend({contain:!0,wrapAround:!1,watchCSS:!1,percentPosition:!0,cellAlign:"left",adaptiveHeight:!1,pageDots:!1,prevNextButtons:!1,autoPlay:!1,freeScroll:!1},t)},a.prototype.getMaxHeight=function(){var e=0;return this.ele.find(".tatsu-carousel-col-inner").each(function(){var t=s(this);e<t.height()&&(e=t.height())}),e},a.prototype.initEqualHeightSlider=function(){var t;"1"===this.ele.attr("data-equal-height")&&(t=this.getMaxHeight(),this.ele.find(".tatsu-carousel-col-inner").height(t),this.ele.addClass("tatsu-equal-height-slider"))},a.prototype.initDestroyInMobile=function(){var t;"1"===this.ele.attr("data-destroy-in-mobile")&&window.innerWidth<768&&"1"===this.ele.attr("data-lazy-load")&&((t=this.ele.find(".tatsu-carousel-col-inner")).css("height","auto"),t.each(function(){var t=s(this),e=t.find(".tatsu-carousel-img").attr("data-aspect-ratio")||1;null!=e&&t.height(t.width()/e)}))},a.prototype.lazyLoadOnScroll=function(){var t;0<this.imagesToLazyLoad.length&&0<(t=this.imagesToLazyLoad.parent().filter(function(){return s(this).isVisible(-100)})).length&&this.loadImages(t.find(".tatsu-carousel-img-lazy-load"))},a.prototype.destroyInMobile=function(){var t=window.innerWidth,e=this.ele.find(".tatsu-carousel-col-inner");this.prevWidth<=767&&767<t?e.css("height",""):767<this.prevWidth&&t<=767?(e.css("width",""),e.each(function(){var t=s(this),e=t.find(".tatsu-carousel-img").attr("data-aspect-ratio")||1;null!=e&&t.height(t.width()/e)})):t<768&&e.each(function(){var t=s(this),e=t.find(".tatsu-carousel-img").attr("data-aspect-ratio")||1;null!=e&&t.height(t.width()/e)})},a.prototype.initVariableSlider=function(){var t,i;"1"===this.ele.attr("data-variable-width")&&(t=this.ele.find(".tatsu-carousel-col-inner"),i=t.height(),768<=window.innerWidth?t.each(function(){var t=s(this),e=t.find(".tatsu-carousel-img").attr("data-aspect-ratio")||1;null!=e&&t.width(i*e)}):null==this.ele.attr("data-destroy-in-mobile")&&t.each(function(){var t=s(this),e=t.find(".tatsu-carousel-img").attr("data-aspect-ratio");null!=e&&t.height(t.width()/e)}))},a.prototype.updateVariableSlider=function(){var t=this.ele.find(".tatsu-carousel-col-inner"),e=window.innerWidth,i=t.height();null==this.ele.attr("data-destroy-in-mobile")?(this.prevWidth<=767&&767<e||767<this.prevWidth&&e<=767?(this.destroy(),new a(this.ele)):768<=window.innerWidth?t.each(function(){var t=s(this),e=t.find(".tatsu-carousel-img").attr("data-aspect-ratio");null!=e&&t.width(i*e)}):(t.css("width",""),t.each(function(){var t=s(this),e=t.find(".tatsu-carousel-img").attr("data-aspect-ratio");null!=e&&t.height(t.width()/e)})),this.ele.hasClass("flickity-enabled")&&this.ele.flickity("reposition")):768<=window.innerWidth?(t.each(function(){var t=s(this),e=t.find(".tatsu-carousel-img").attr("data-aspect-ratio");null!=e&&t.width(i*e)}),this.ele.hasClass("flickity-enabled")&&this.ele.flickity("reposition")):null==this.ele.attr("data-lazy-load")&&t.css("width","")},a.prototype.flickityInit=function(){"1"===this.ele.attr("data-lazy-load")&&this.lazyLoad(),this.ele.addClass("tatsu-carousel-initialized")},a.prototype.updatePreviousWidth=function(){this.prevWidth=window.innerWidth},a.prototype.initEvents=function(){this.ele.on("ready.flickity",this.flickityInit),"1"===this.ele.attr("data-lazy-load")&&(this.ele.on("scroll.flickity",this.throttledLazyLoad),o.on("scroll",this.lazyLoadOnScroll),this.lazyLoadOnScroll()),"1"===this.ele.attr("data-destroy-in-mobile")&&o.on("debouncedresize",this.destroyInMobile),"1"===this.ele.attr("data-fullscreen")&&o.on("debouncedresize",this.updateFullscreenSlider),"1"===this.ele.attr("data-variable-width")&&o.on("debouncedresize",this.updateVariableSlider),o.on("debouncedresize",this.updatePreviousWidth)},a.prototype.removeEvents=function(){this.ele.off("ready.flickity",this.flickityInit),"1"===this.ele.attr("data-lazy-load")&&this.ele.off("scroll.flickity",this.throttledLazyLoad),"1"===this.ele.attr("data-destroy-in-mobile")&&"1"===this.ele.attr("data-lazy-load")&&(o.off("scroll",this.lazyLoadOnScroll),o.off("debouncedresize",this.destroyInMobile)),"1"===this.ele.attr("data-fullscreen")&&o.off("debouncedresize",this.updateFullscreenSlider),"1"===this.ele.attr("data-variable-width")&&o.off("debouncedresize",this.updateVariableSlider),o.off("debouncedresize",this.updatePreviousWidth)},a.prototype.destroy=function(){this.ele.find(".tatsu-carousel-col-inner").css({height:"",width:""}),this.removeEvents(),this.ele.flickity("destroy"),this.ele.removeClass("tatsu-carousel-initialized")},a.prototype.initLazyLoad=function(){this.imagesToLazyLoad=null,"1"===this.ele.attr("data-lazy-load")&&(this.imagesToLazyLoad=this.ele.find(".tatsu-carousel-img-lazy-load"))},a.prototype.getDoppelgangers=function(t){var e=[],i=s();return 0<this.imagesToLazyLoad.length&&(t.each(function(){e.push(s(this).attr("data-src"))}),this.imagesToLazyLoad.each(function(){var t=s(this);0<t.length&&null==t.attr("src")&&-1<e.indexOf(t.attr("data-src"))&&(i=i.add(t))})),i},a.prototype.loadImages=function(t){this.ele.hasClass("tatsu-carousel-adaptive-image");t.one("load",function(){s(this).addClass("tatsu-carousel-img-lazy-loaded")}).each(function(){var t,e=s(this),i="."+(e.attr("data-src")||e.attr("src")).split(".").pop(),a="1"===e.attr("data-webp");"supported"===window.webpSupport&&a&&(a=e.attr("data-srcset"),t=e.attr("data-src"),i=new RegExp("\\"+i,"g"),a=a&&a.replace(i,".webp"),t=t&&t.replace(i,".webp"),e.attr("data-srcset")&&e.attr("data-srcset",a),e.attr("data-src"))&&e.attr("data-src",t),e.attr("data-srcset")&&e.attr("srcset",e.attr("data-srcset")),e.attr("data-src")&&e.attr("src",e.attr("data-src"))}),this.imagesToLazyLoad=this.imagesToLazyLoad.not(t),0==this.imagesToLazyLoad.length&&(this.ele.off("scroll.flickity",this.throttledLazyLoad),o.off("scroll",this.lazyLoadOnScroll))},a.prototype.getVisibleSlides=function(){var t=this.ele.find(".flickity-viewport"),e=t.offset().left,i=e,a=e+t.width();return this.inViewport?this.imagesToLazyLoad.filter(function(){var t=s(this).parent(),e=t.offset().left,t=t.offset().left+t.outerWidth(!0);return i<t&&t<=a||e<a&&i<=e}):[]},a.prototype.lazyLoad=function(){var t;0<this.imagesToLazyLoad.length&&null!=(t=this.getVisibleSlides())&&0<t.length&&this.loadImages(t)},a.prototype.initFlickity=function(){this.ele.flickity(this.settings)},a},jQuery);